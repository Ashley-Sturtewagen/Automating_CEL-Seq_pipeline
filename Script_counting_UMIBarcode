
Open interactive Jupyter notebook

with open(get(filenumber in Galaxy),'r') as samfile:
    count = 0
    linelist = []
    UMIlist = []
    barcodelist = []
    idlist = []

    for line in samfile:
        if line[0:1] == "@":
            continue
        count += 1
        # print(line)
        linesplit = line.split("\t")
        linelist.append(linesplit)

for line in linelist:
    # print(line[0].split("_")[1])

    UMIlist.append(line[0].split("_")[1])
    #barcodelist.append(line[0](line[0])
    barcode = line[0]
    barcode_sequence = barcode[-6:]
    barcodelist.append(barcode_sequence)
    idlist.append(line[2].split("|")[0])
    #print(UMIlist, barcodelist, idlist)
    #print(line[0].split("_")[1:3],line[2].split("|")[0])
    # line [0] is element QNAME split on _ and take the first barcode , Line [2] is elemen

print(f"Total number of lines in the samfile is: {len(linelist)}")
# Python f strings embed expressions into a string literal. You can use f strings to embed variables, strings, or the results of functions into a string. An f string are prefixed with “f” at the start, before the string itself begins. Introduced in Python 3.6, make it easier to format strings

import pandas as pd

df = pd.DataFrame({'UMI': UMIlist, 'Barcode': barcodelist, 'ID': idlist})
df1 = df.drop_duplicates()
#print(df1)
counter = df1[df1.columns[0]].count()
#print(counter)

pf = pd.crosstab(index=df1['Barcode'], columns='counter')
#print(pf)
df2 = pd.crosstab(index=df1['ID'], columns=df['Barcode'])
#print(df2)

